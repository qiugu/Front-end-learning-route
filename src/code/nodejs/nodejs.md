# Nodejs学习

## Node特点

* 单线程
* 事件驱动
* 非阻塞IO

## 事件轮询机制

[参考](https://nodejs.org/zh-cn/docs/guides/event-loop-timers-and-nexttick/)

```text
   ┌───────────────────────────┐
┌─>│           timers          │
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
│  │     pending callbacks     │
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
│  │       idle, prepare       │
│  └─────────────┬─────────────┘      ┌───────────────┐
│  ┌─────────────┴─────────────┐      │   incoming:   │
│  │           poll            │<─────┤  connections, │
│  └─────────────┬─────────────┘      │   data, etc.  │
│  ┌─────────────┴─────────────┐      └───────────────┘
│  │           check           │
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
└──┤      close callbacks      │
   └───────────────────────────┘
```

* 定时器：本阶段执行已经被 setTimeout\(\) 和 setInterval\(\) 的调度回调函数。
* 待定回调：执行延迟到下一个循环迭代的 I/O 回调。
* idle, prepare：仅系统内部使用。
* 轮询：检索新的 I/O 事件;执行与 I/O 相关的回调（几乎所有情况下，除了关闭的回\* 调函数，那些由计时器和 setImmediate\(\) 调度的之外），其余情况 node 将在适当的时候在此阻塞。
* 检测：setImmediate\(\) 回调函数在这里执行。
* 关闭的回调函数：一些关闭的回调函数，如：socket.on\('close', ...\)。

## 错误处理

node中的错误如果未捕获的话，一旦发生则会导致整个程序中断无法继续执行下去。

```javascript
const http = require('http')

http.createServer(() => {
   throw new Error('当前错误未被捕获')
}).listen(3000)
```

所以在一般的node内置模块都会分发error事件，错误处理的每一步都非常重要，另外在node的回调中也遵循着错误优先的原则，回调函数的第一个参数表示error

## Buffer

## Stream

## Node中的TCP

1. TCP的特性
2. 面向连接的通信和保证顺序的传递
3. 面向字节
4. 可靠性
5. 流控制
6. 拥堵控制

